generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model accessory {
  id             Int              @id @default(autoincrement())
  name           String
  description    String
  price          Float
  fabricId       Int?
  image          String?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime
  color          String?
  artisanId      Int?
  artisan        artisan?         @relation(fields: [artisanId], references: [id], onDelete: Cascade)
  fabric         fabric?          @relation(fields: [fabricId], references: [id], onDelete: Cascade)
  accessoryimage accessoryimage[]
  country        country[]        @relation("accessorycountries")

  @@index([artisanId])
  @@index([fabricId])
}

model accessoryimage {
  id          Int       @id @default(autoincrement())
  url         String
  altText     String?
  accessoryId Int
  accessory   accessory @relation(fields: [accessoryId], references: [id], onDelete: Cascade)

  @@index([accessoryId])
}

model artisan {
  id        Int         @id @default(autoincrement())
  name      String
  countryId Int
  accessory accessory[]
  country   country      @relation(fields: [countryId], references: [id], onDelete: Cascade) // Relation définie ici
  model     model[]
  product   product[]

  @@index([countryId])
}

model country {
  id          Int         @id @default(autoincrement())
  name        String      @unique
  artisans    artisan[]   @relation(fields: [], references: []) // Relation inversée définie ici
  accessories accessory[] @relation("accessorycountries")
  fabrics     fabric[]    @relation("fabriccountries")
  models      model[]     @relation("modelcountries")
  products    product[]   @relation("productcountries")
}

model fabric {
  id          Int           @id @default(autoincrement())
  material    String?
  pattern     String?
  productId   Int      @unique  // Chaque tissu est lié à un produit unique
  
  origin      String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime
  color       String?
  size        Float?
  name        String
  image       String?
  product product @relation("FabricToProduct",fields: [productId], references: [id], onDelete: Cascade) // Relation avec product

  price       Float
  accessory   accessory[]
  fabricimage fabricimage[]
  model       model[]
  country     country[]     @relation("fabriccountries")
}

model fabricimage {
  id       Int     @id @default(autoincrement())
  url      String
  altText  String?
  fabricId Int
  fabric   fabric  @relation(fields: [fabricId], references: [id], onDelete: Cascade)

  @@index([fabricId])
}

model model {
  id          Int          @id @default(autoincrement())
  name        String
  description String
  price       Float
  product     product   @relation(fields: [productId], references: [id], onDelete: Cascade) // Relation avec product
  productId   Int  
  fabricId    Int?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime
  color       String?
  artisanId   Int?
  image       String?
  artisan     artisan?     @relation(fields: [artisanId], references: [id], onDelete: Cascade)
  fabric      fabric?      @relation(fields: [fabricId], references: [id], onDelete: Cascade)
  modelimage  modelimage[]
  country     country[]    @relation("modelcountries")

  @@index([artisanId])
  @@index([fabricId])
}

model modelimage {
  id      Int     @id @default(autoincrement())
  url     String
  altText String?
  modelId Int
  model   model   @relation(fields: [modelId], references: [id], onDelete: Cascade)

  @@index([modelId])
}

model order {
  id        Int         @id @default(autoincrement())
  userId    Int
  total     Float
  createdAt DateTime    @default(now())
  user      user        @relation(fields: [userId], references: [id], onDelete: Cascade)
  orderitem orderitem[]

  @@index([userId])
}

model orderitem {
  id        Int       @id @default(autoincrement())
  orderId   Int
  productId Int
  quantity  Int
  price     Float
  product   product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  order     order     @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([orderId])
}

model product {
  id          Int              @id @default(autoincrement())
  name        String
  description String           @db.Text
  models      model[]  
  price       Float
  category    product_category
  image       String
  createdAt   DateTime         @default(now())
  updatedAt   DateTime
  available   Boolean          @default(true)
  artisanId   Int?
  color       String?
  fabric      fabric?   @relation("FabricToProduct") // Ajout de la relation inverse
  material    String?
  artisan     artisan?         @relation(fields: [artisanId], references: [id])
  country     country[]        @relation("productcountries")
  
  orderitem   orderitem[]

  @@index([artisanId])
}

model user {
  id            Int         @id @default(autoincrement())
  email         String      @unique
  password      String
  role          user_role   @default(USER)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  emailVerified DateTime?
  order         order[]
}

model verificationtoken {
  id      Int      @id @default(autoincrement())
  email   String
  token   String   @unique
  expires DateTime
}

enum user_role {
  USER
  ADMIN
}

enum product_category {
  FABRIC
  MODEL
  ACCESSORY
}
